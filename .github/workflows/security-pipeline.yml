name: Security Pipeline (SAST + DAST)



on:

  push:

    branches: [ main ]

  pull_request:

    branches: [ main ]



jobs:

  sast-lint:

    name: SAST — HTML & CSS linters

    runs-on: ubuntu-latest



    steps:

      - name: Checkout

        uses: actions/checkout@v4



      - name: Setup Node.js

        uses: actions/setup-node@v4

        with:

          node-version: '18'



      - name: Install dependencies

        run: npm ci



      - name: Run HTMLHint

        run: npm run lint:html



      - name: Run Stylelint

        run: npm run lint:css



  dast-zap:

    name: DAST — OWASP ZAP full scan

    runs-on: ubuntu-latest

    needs: sast-lint

    steps:

      - name: Checkout

        uses: actions/checkout@v4



      - name: Setup Node.js

        uses: actions/setup-node@v4

        with:

          node-version: '18'



      - name: Install dependencies

        run: npm ci



      - name: Start static server (background)

        run: |

          npx http-server -p 8080 &

          echo "Aguardando servidor..."

          for i in {1..15}; do

            curl -sSf http://127.0.0.1:8080 && break || sleep 1

          done



      - name: Run ZAP full scan

        uses: zaproxy/action-full-scan@v0.12.0

        with:

          target: 'http://127.0.0.1:8080'

          format: 'html'

          report_file: 'zap-report.html'



      - name: Upload ZAP report

        if: always()

        uses: actions/upload-artifact@v4

        with:

          name: zap-report

          path: zap-report.html



